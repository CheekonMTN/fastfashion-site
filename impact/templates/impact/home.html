{% extends "impact/base.html" %}

{% load static %}

{% block title %}Fighting Fast Fashion{% endblock %}

{% block content %}

<section class="hero hero-video">
    <!-- Background video -->
    <div class="hero-video-bg">
        <video
            class="hero-video-tag"
            autoplay
            muted
            loop
            playsinline
            poster="{% static 'impact/imgs/clothes-on-rack2.jpg' %}">
            <source src="{% static 'impact/videos/beach-background.mp4' %}" type="video/mp4">
            <!-- Fallback text -->
            Your browser does not support the video tag.
        </video>
    </div>

    <!-- Overlay with text and card -->
    <div class="hero-overlay">
        <div class="hero-inner hero-overlay-inner">
            <div class="hero-text">
                <p class="hero-tagline">Fast fashion's hidden environmental cost</p>

                <h1 class="hero-title">
                    A clear, data-driven look at how fast fashion impacts water,
                    waste, and the planet.
                </h1>
            </div>

                <div class="hero-buttons">
                <a href="#calculator" class="btn pill">
                    Calculate Your Impact
                </a>
                <a href="#problem" class="btn pill">
                        Explore the data
                    </a>
            </div>
        </div>
    </div>
</section>

<!-- STRIP SECTION -->
<section class="strip">
    <div class="strip-inner">
        <h2 class="strip-title">A global industry, a global footprint</h2>
        <p class="strip-text">
            Cotton, polyester, viscose: fast fashion relies on materials with heavy resource demands.
            From water use to textile waste, this overview highlights the scale of the issue.
        </p>
        <div class="strip-image">
            <img src="{% static 'impact/imgs/clothes-on-rack.jpg' %}" alt="Clothing on rack representing fast fashion production" class="strip-img">
        </div>
    </div>
</section>

<!-- PERSONAL IMPACT CALCULATOR -->
<section id="calculator" class="section section-calculator section-anchor-offset">
    <div class="section-inner">
        <h2 class="section-heading">Calculate Your Impact</h2>
        <p class="section-text">
            Start by seeing how your clothing choices add up. Enter your annual purchases to discover your personal 
            water footprint, carbon emissions, and waste contribution.
        </p>
        
        <div class="calculator-container">
            <div class="calculator-inputs">
                <div class="calc-mode-toggle">
                    <button class="calc-mode-btn active" data-mode="simple">Simple</button>
                    <button class="calc-mode-btn" data-mode="detailed">Detailed</button>
                </div>
                
                <!-- Simple Mode -->
                <div id="simple-mode" class="calc-mode-content active">
                    <div class="calc-input-group">
                        <label for="items-per-year">How many clothing items do you buy per year?</label>
                        <input type="number" id="items-per-year" min="0" max="500" value="20" step="1">
                        <span class="calc-hint">Average: 20-30 items per year</span>
                    </div>
                    
                    <div class="calc-input-group">
                        <label for="material-type">Primary material type</label>
                        <select id="material-type">
                            <option value="cotton">Cotton</option>
                            <option value="polyester">Polyester</option>
                            <option value="viscose">Viscose</option>
                            <option value="mixed">Mixed (average)</option>
                        </select>
                    </div>
                </div>
                
                <!-- Detailed Mode -->
                <div id="detailed-mode" class="calc-mode-content">
                    <div class="calc-input-group">
                        <label for="shirts">T-shirts & Shirts</label>
                        <input type="number" id="shirts" min="0" max="200" value="0" step="1">
                    </div>
                    <div class="calc-input-group">
                        <label for="pants">Pants & Jeans</label>
                        <input type="number" id="pants" min="0" max="200" value="0" step="1">
                    </div>
                    <div class="calc-input-group">
                        <label for="dresses">Dresses & Skirts</label>
                        <input type="number" id="dresses" min="0" max="200" value="0" step="1">
                    </div>
                    <div class="calc-input-group">
                        <label for="shoes">Shoes & Footwear</label>
                        <input type="number" id="shoes" min="0" max="200" value="0" step="1">
                    </div>
                    <div class="calc-input-group">
                        <label for="outerwear">Jackets & Outerwear</label>
                        <input type="number" id="outerwear" min="0" max="200" value="0" step="1">
                    </div>
                    <div class="calc-input-group">
                        <label for="accessories">Accessories (bags, hats, etc.)</label>
                        <input type="number" id="accessories" min="0" max="200" value="0" step="1">
                    </div>
                    <div class="calc-input-group">
                        <label for="material-type-detailed">Primary material type</label>
                        <select id="material-type-detailed">
                            <option value="cotton">Cotton</option>
                            <option value="polyester">Polyester</option>
                            <option value="viscose">Viscose</option>
                            <option value="mixed">Mixed (average)</option>
                        </select>
                    </div>
                </div>
                
                <button id="calculate-btn" class="btn-calculate">Calculate My Impact</button>
            </div>
            
            <div id="calculator-results" class="calculator-results" style="display: none;">
                <h3 class="results-title">Your Annual Impact</h3>
                
                <!-- Comparison to Average -->
                <div class="results-comparison-banner" id="comparison-banner">
                    <div class="comparison-icon">üìä</div>
                    <div class="comparison-text">
                        <strong id="comparison-title">Compared to average</strong>
                        <span id="comparison-details"></span>
                    </div>
                </div>
                
                <div class="results-grid">
                    <div class="result-card">
                        <div class="result-icon">üíß</div>
                        <div class="result-value" id="water-result">0</div>
                        <div class="result-label">Liters of water</div>
                        <div class="result-comparison" id="water-comparison"></div>
                    </div>
                    
                    <div class="result-card">
                        <div class="result-icon">üåç</div>
                        <div class="result-value" id="co2-result">0</div>
                        <div class="result-label">kg CO‚ÇÇ emissions</div>
                        <div class="result-comparison" id="co2-comparison"></div>
                    </div>
                    
                    <div class="result-card">
                        <div class="result-icon">üóëÔ∏è</div>
                        <div class="result-value" id="waste-result">0</div>
                        <div class="result-label">kg textile waste</div>
                        <div class="result-comparison" id="waste-comparison"></div>
                    </div>
                </div>
                
                <div class="results-tip">
                    <p><strong>üí° Tip:</strong> Extending the life of your clothes by just 9 months can reduce your environmental impact by 20-30%.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="live-water-section">
    <div class="live-water-inner">
        <h2 class="live-water-title">Live Water Use ¬∑ Fashion Industry</h2>
        <p class="live-water-sub">Updated every second</p>

        <div class="live-water-grid">
            <!-- Card 1: liters -->
            <article class="live-water-card">
                <p class="live-water-label">Liters used this year</p>
                <p class="live-water-value">
                    <span id="waterYearLitersDisplay">0</span>
                </p>
                <p class="live-water-note">Total water flowing through the fashion and textile system.</p>
            </article>

            <!-- Card 2: bathtubs -->
            <article class="live-water-card">
                <p class="live-water-label">Bathtubs of water</p>
                <p class="live-water-value">
                    <span id="waterYearBathtubsDisplay">0</span>
                </p>
                <p class="live-water-note">Assuming about 150 liters per full bathtub.</p>
            </article>

            <!-- Card 3: 1-L bottles -->
            <article class="live-water-card">
                <p class="live-water-label">1-L bottles</p>
                <p class="live-water-value">
                    <span id="waterYearBottlesDisplay">0.0</span> B
                </p>
                <div class="live-water-bottle-bar">
                    <div class="live-water-bottle-track">
                        <div class="live-water-bottle-fill">
                            <div class="live-water-bottle-icons">
                                <div class="live-bottle"></div>
                                <div class="live-bottle"></div>
                                <div class="live-bottle"></div>
                                <div class="live-bottle"></div>
                                <div class="live-bottle"></div>
                                <div class="live-bottle"></div>
                                <div class="live-bottle"></div>
                                <div class="live-bottle"></div>
                            </div>
                        </div>
                    </div>
                    <p class="live-water-note">Visualized as single-liter water bottles.</p>
                </div>
                
            </article>
        </div>

        <p class="live-water-footnote">
            Based on global textile industry estimates (‚âà93 billion cubic meters annually).
            This counter converts that to liters per second and multiplies by the time since
            January 1st. It illustrates scale rather than providing an exact real-time reading.
        </p>
    </div>
</section>

<!-- PROBLEM SECTION -->
<section id="problem" class="section section-problem section-anchor-offset">
    <div class="section-inner">
        <h2 class="section-heading">The Problem</h2>
        <section class="section">       
                <p class="section-text">
                    Fast fashion depends on low-cost fibers that require large amounts of water, energy,
                    and chemicals. Below you'll find headline statistics drawn from public reports, plus
                    charts that put the scale of the problem into context.
                </p>
            </div>
        </section>
        
        <section id="headline" class="section alt">
            <div class="section-inner">
                <h2 class="subheading">Headline numbers</h2>
                <p class="section-text">
                    These values are rounded estimates. They are meant to show scale, not exact predictions
                    for every brand or garment.
                </p>
        
                <div class="stats-grid">
                    {% for stat in stats %}
                    <article class="stat-card">
                        <p class="stat-title">{{ stat.title }}</p>
                        <p class="stat-value">{{ stat.value }} {{ stat.unit }}</p>
                        <p class="stat-desc">{{ stat.description }}</p>
                        {% if stat.source %}
                            <p class="stat-source">Source: {{ stat.source }}</p>
                        {% endif %}
                    </article>
                    {% empty %}
                    <p>No stats added yet. Use the admin site to create a few headline values.</p>
                    {% endfor %}
                </div>
            </div>
        </section>
        
                </div> <!-- end of .stats-grid -->
        
                <p class="section-text" style="margin-top: 10px;">
                    <strong>Note:</strong> These numbers come from public reports and industry analyses.
                    They show approximate scale, not exact predictions for every brand or garment.
                    Water use, emissions, and waste vary by region, production method, and year.
                </p>
        
            </div> <!-- end of .section-inner -->
        </section>
        
        </div> <!-- end of .section-inner -->
        </section>
        
        <section class="section">
            <div class="section-inner">
                <h2 class="subheading">Why fast fashion uses so much water</h2>
                <p class="section-text">
                    Cotton farming is one of the most water-intensive agricultural systems in the world, 
                    especially in dry regions where irrigation is required. On top of farming, dyeing, 
                    bleaching, and finishing fabrics use millions of liters of water each day. As fashion 
                    production accelerated in the 2000s, water use rose dramatically to keep up with demand.
                </p>
            </div>
        </section>
        
        <section class="section">
            <div class="section-inner">
                <h2 class="subheading">Explosion of synthetic fibers</h2>
                <p class="section-text">
                    Today, around 69% of all global fiber production is synthetic ‚Äî mainly polyester made 
                    from fossil fuels. These fibers are cheap, versatile, and perfectly suited for fast 
                    fashion‚Äôs rapid turnover model. However, synthetic production carries significant 
                    environmental costs, including high energy use, carbon emissions, and long-lasting waste.
                </p>
            </div>
        </section>
        
        <section class="section">
            <div class="section-inner">
                <h2 class="subheading">Overproduction and short clothing lifespans</h2>
                <p class="section-text">
                    The fashion industry now produces more than 100 billion garments annually ‚Äî more than 
                    enough for every person on Earth to buy 12‚Äì14 items every year. Many of these pieces 
                    are worn only a handful of times. About 60% of clothing is discarded within one year, 
                    contributing to massive resource waste and landfill buildup.
                </p>
            </div>
        </section>
        
        <section class="section">
            <div class="section-inner">
                <h2 class="subheading">What happens to clothes after we throw them away?</h2>
                <div class="content-with-image">
                    <div class="text-content">
                <p class="section-text">
                    Around 87% of discarded textiles end up in landfills or incinerators. Only a small 
                    portion is recycled, and most of that is downcycled into lower-quality materials like 
                    insulation or industrial rags. Synthetic clothes can take decades to centuries to break 
                    down, releasing microplastics and chemicals as they degrade.
                </p>
                    </div>
                    <div class="image-content">
                        <img src="{% static 'impact/imgs/landfill.jpg' %}" alt="Textile waste in landfill" class="section-img">
                    </div>
                </div>
            </div>
        </section>
        
        <section class="section">
            <div class="section-inner">
                <h2 class="subheading">Microplastics from polyester</h2>
                <p class="section-text">
                    Each load of laundry releases hundreds of thousands of tiny synthetic fibers into 
                    waterways. These microplastics have been found in oceans, soil, food, drinking water, 
                    and even human blood. Because polyester dominates the fast fashion market, microfiber 
                    pollution is growing quickly and has become one of the biggest environmental concerns 
                    connected to clothing.
                </p>
            </div>
        </section>
        
        <section class="section alt">
            <div class="section-inner">
                <h2 class="subheading">Fashion before vs. after the fast fashion boom</h2>
                <div class="card-grid three">
                    <article class="info-card">
                        <h3>Before (1990s)</h3>
                        <p>Seasonal collections</p>
                        <p>Higher-quality materials</p>
                        <p>More natural fibers</p>
                        <p>Less waste</p>
                    </article>
        
                    <article class="info-card">
                        <h3>Today</h3>
                        <p>Ultra-fast production cycles</p>
                        <p>More synthetic fibers</p>
                        <p>Lower durability</p>
                        <p>Rising water use and waste</p>
                    </article>
        
                    <article class="info-card">
                        <h3>The impact</h3>
                        <p>Increased landfill buildup</p>
                        <p>More microplastics released</p>
                        <p>Higher global emissions</p>
                        <p>Greater demand for resources</p>
                    </article>
                </div>
            </div>
        </section>
        
        
        
        <section class="section">
            <div class="section-inner">
                <h2 class="subheading">Material Impact Comparison</h2>
                <p class="section-text">
                    Compare the environmental impact of different materials. Hover over each bar to see detailed metrics. 
                    The numbers might surprise you.
                </p>
                
                <div class="interactive-chart">
                    <div class="chart-controls">
                        <button class="chart-btn active" data-metric="water">Water Usage</button>
                        <button class="chart-btn" data-metric="co2">CO‚ÇÇ Emissions</button>
                        <button class="chart-btn" data-metric="waste">Waste Impact</button>
                    </div>
                    
                    <div class="chart-container">
                        <div class="chart-bars" id="material-chart">
                            <div class="chart-bar-wrapper" data-material="cotton">
                                <div class="chart-bar" data-value="10000" style="--bar-color: #2f6f4e;">
                                    <div class="bar-fill"></div>
                                    <div class="bar-label">Cotton</div>
                                    <div class="bar-value">10,000L</div>
                                    <div class="bar-tooltip">
                                        <strong>Cotton</strong><br>
                                        Water: 10,000L/kg<br>
                                        CO‚ÇÇ: 15kg/kg<br>
                                        Most water-intensive
                                    </div>
                                </div>
                            </div>
                            
                            <div class="chart-bar-wrapper" data-material="polyester">
                                <div class="chart-bar" data-value="2000" style="--bar-color: #d97757;">
                                    <div class="bar-fill"></div>
                                    <div class="bar-label">Polyester</div>
                                    <div class="bar-value">2,000L</div>
                                    <div class="bar-tooltip">
                                        <strong>Polyester</strong><br>
                                        Water: 2,000L/kg<br>
                                        CO‚ÇÇ: 25kg/kg<br>
                                        Highest emissions
                                    </div>
                                </div>
                            </div>
                            
                            <div class="chart-bar-wrapper" data-material="viscose">
                                <div class="chart-bar" data-value="6000" style="--bar-color: #95d5b2;">
                                    <div class="bar-fill"></div>
                                    <div class="bar-label">Viscose</div>
                                    <div class="bar-value">6,000L</div>
                                    <div class="bar-tooltip">
                                        <strong>Viscose</strong><br>
                                        Water: 6,000L/kg<br>
                                        CO‚ÇÇ: 12kg/kg<br>
                                        Chemical-intensive
                                    </div>
                                </div>
                            </div>
                            
                            <div class="chart-bar-wrapper" data-material="wool">
                                <div class="chart-bar" data-value="8000" style="--bar-color: #1f3f30;">
                                    <div class="bar-fill"></div>
                                    <div class="bar-label">Wool</div>
                                    <div class="bar-value">8,000L</div>
                                    <div class="bar-tooltip">
                                        <strong>Wool</strong><br>
                                        Water: 8,000L/kg<br>
                                        CO‚ÇÇ: 18kg/kg<br>
                                        High methane emissions
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="chart-legend">
                            <p class="chart-note">* Per kilogram of fiber produced</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <section class="section alt">
            <div class="section-inner">
                <h2 class="subheading">The Fast Fashion Explosion</h2>
                <p class="section-text">
                    See how dramatically the fashion industry changed. The numbers tell a shocking story of growth and waste.
                </p>
                
                <div class="comparison-visual">
                    <div class="comparison-container">
                        <div class="comparison-item">
                            <div class="comparison-label">
                                <span class="comparison-year">1990s</span>
                                <span class="comparison-title">Before Fast Fashion</span>
                            </div>
                            <div class="comparison-bar-wrapper">
                                <div class="comparison-bar before" data-value="20">
                                    <div class="bar-fill-animated"></div>
                                    <div class="bar-text">20 billion garments/year</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="comparison-divider">
                            <div class="divider-line"></div>
                            <div class="divider-arrow">‚Üí</div>
                            <div class="divider-text">500% increase</div>
                        </div>
                        
                        <div class="comparison-item">
                            <div class="comparison-label">
                                <span class="comparison-year">Today</span>
                                <span class="comparison-title">Fast Fashion Era</span>
                            </div>
                            <div class="comparison-bar-wrapper">
                                <div class="comparison-bar after" data-value="100">
                                    <div class="bar-fill-animated"></div>
                                    <div class="bar-text">100+ billion garments/year</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="comparison-stats">
                        <div class="comparison-stat-card">
                            <div class="stat-icon">üìà</div>
                            <div class="stat-number" data-target="500">0</div>
                            <div class="stat-label">% Production Increase</div>
                        </div>
                        <div class="comparison-stat-card">
                            <div class="stat-icon">‚è±Ô∏è</div>
                            <div class="stat-number" data-target="52">0</div>
                            <div class="stat-label">Collections Per Year</div>
                        </div>
                        <div class="comparison-stat-card">
                            <div class="stat-icon">üóëÔ∏è</div>
                            <div class="stat-number" data-target="92">0</div>
                            <div class="stat-label">Million Tons Waste/Year</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
</section>

<!-- SOLUTIONS SECTION -->
<section id="solutions" class="section section-solutions section-anchor-offset">
    <div class="section-inner">
        <h2 class="section-heading">Solutions</h2>
        <section class="section">
                <p class="section-text">
                    Individuals aren‚Äôt responsible for fixing the fashion system‚Äîbut we can still take
                    actions that matter. Here are realistic steps, plus a brief fairness and ethics check
                    to keep things grounded.
                </p>
            </div>
        </section>
        
        <section class="section alt">
            <div class="section-inner">
                <h2 class="subheading">Fairness & Ethics</h2>
                <p class="section-text">
                    Sustainability often costs more. Not everyone can afford slow fashion, sustainable
                    brands, or specialty materials. Any ‚Äúsolution‚Äù must respect budgets, needs, and access.
                </p>
            </div>
        </section>
        
        <section class="section">
            <div class="section-inner">
                <h2 class="subheading">Realistic Actions</h2>
        
                <ul class="action-list">
                    <li>Buy fewer new items and wear the ones you have longer.</li>
                    <li>When affordable, try second-hand or clothing swaps.</li>
                    <li>Repair small rips or missing buttons instead of replacing clothes.</li>
                    <li>Donate or recycle textiles locally when possible.</li>
                    <li>Talk with friends about habits and sustainable options.</li>
                </ul>
            </div>
        </section>
    </div>
</section>

<!-- SOURCES / REFERENCES SECTION -->
<section id="sources" class="section section-sources section-anchor-offset">
    <div class="section-inner">
        <h2 class="section-heading">Sources</h2>
        <section class="section">
        
                <p class="section-text">
                    These are the reports, articles, and datasets used to create the headline numbers
                    and visuals on this site.
                </p>
        
                <ul class="source-list">
                    <li>Replace with your real sources from your research.</li>
                    <li>UN reports, Ellen MacArthur Foundation, WRAP, etc.</li>
                    <li>Articles on water use, CO‚ÇÇ emissions, textile waste.</li>
                    <li>Datasets on global production and disposal trends.</li>
                </ul>
            </div>
        </section>
    </div>
</section>
<script>
    function setYearProgress() {
        const now = new Date();
    
        // Start of this year (Jan 1, 00:00)
        const startOfYear = new Date(now.getFullYear(), 0, 1);
    
        // Start of next year (Jan 1 next year, 00:00)
        const startOfNextYear = new Date(now.getFullYear() + 1, 0, 1);
    
        const elapsedMs = now - startOfYear;
        const totalMs = startOfNextYear - startOfYear;
    
        let progress = (elapsedMs / totalMs) * 100;
    
        console.log("Year progress = ", progress);  // debug
    
        // Clamp to 0‚Äì100
        if (progress < 0) progress = 0;
        if (progress > 100) progress = 100;
    
        // Write into the CSS variable on :root (html element)
        document.documentElement.style.setProperty("--water-progress", progress);
    }
    
    // Run once when the page is ready
    document.addEventListener("DOMContentLoaded", setYearProgress);
    </script>

<script>
    // Personal Impact Calculator
    document.addEventListener("DOMContentLoaded", function() {
        const calculateBtn = document.getElementById("calculate-btn");
        const itemsInput = document.getElementById("items-per-year");
        const materialSelect = document.getElementById("material-type");
        const resultsDiv = document.getElementById("calculator-results");
        
        // Mode toggle
        const modeButtons = document.querySelectorAll('.calc-mode-btn');
        const simpleMode = document.getElementById('simple-mode');
        const detailedMode = document.getElementById('detailed-mode');
        
        modeButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                const mode = this.dataset.mode;
                modeButtons.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                if (mode === 'simple') {
                    simpleMode.classList.add('active');
                    detailedMode.classList.remove('active');
                } else {
                    simpleMode.classList.remove('active');
                    detailedMode.classList.add('active');
                }
            });
        });
        
        // Impact data per item (approximate averages in kg)
        const impactData = {
            cotton: {
                water: 10000,      // liters per kg (cotton is very water-intensive)
                co2: 15,           // kg CO2 per kg
                waste: 0.5         // kg waste per item (average)
            },
            polyester: {
                water: 2000,       // liters per kg (less water, but more energy)
                co2: 25,           // kg CO2 per kg (higher due to fossil fuels)
                waste: 0.5
            },
            viscose: {
                water: 6000,       // liters per kg
                co2: 12,           // kg CO2 per kg
                waste: 0.5
            },
            mixed: {
                water: 6000,       // average
                co2: 17,           // average
                waste: 0.5
            }
        };
        
        // Average weight per clothing item type (kg)
        const itemWeights = {
            shirts: 0.2,      // 200g average
            pants: 0.5,       // 500g average
            dresses: 0.4,    // 400g average
            shoes: 0.8,      // 800g average
            outerwear: 0.7,  // 700g average
            accessories: 0.15 // 150g average
        };
        
        // Average weight per clothing item (kg) - for simple mode
        const avgItemWeight = 0.3; // 300g average per item
        
        // Average person buys 25 items per year
        const averageItemsPerYear = 25;
        
        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + "M";
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + "k";
            }
            return Math.round(num).toLocaleString();
        }
        
        function animateValue(element, start, end, duration, formatFunc) {
            const startTime = performance.now();
            const isDecimal = end % 1 !== 0;
            
            function update(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // Easing function for smooth animation
                const easeOutQuart = 1 - Math.pow(1 - progress, 4);
                const current = start + (end - start) * easeOutQuart;
                
                if (isDecimal || end < 1000) {
                    element.textContent = formatFunc(current);
                } else {
                    element.textContent = formatFunc(Math.round(current));
                }
                
                if (progress < 1) {
                    requestAnimationFrame(update);
                } else {
                    // Ensure final value is exact
                    element.textContent = formatFunc(end);
                }
            }
            
            requestAnimationFrame(update);
        }
        
        function calculateImpact() {
            let items = 0;
            let totalWeight = 0;
            let material = '';
            
            // Check which mode is active
            const isDetailed = detailedMode.classList.contains('active');
            
            if (isDetailed) {
                // Detailed mode: calculate from item breakdown
                const itemTypes = ['shirts', 'pants', 'dresses', 'shoes', 'outerwear', 'accessories'];
                material = document.getElementById('material-type-detailed').value;
                
                itemTypes.forEach(type => {
                    const count = parseInt(document.getElementById(type).value) || 0;
                    items += count;
                    totalWeight += count * itemWeights[type];
                });
            } else {
                // Simple mode
                items = parseInt(itemsInput.value) || 0;
                material = materialSelect.value;
                totalWeight = items * avgItemWeight;
            }
            
            if (items <= 0) {
                alert("Please enter a valid number of items.");
                return;
            }
            
            const data = impactData[material];
            
            // Calculate impacts
            const waterLiters = totalWeight * data.water;
            const co2Kg = totalWeight * data.co2;
            const wasteKg = items * data.waste;
            
            // Calculate average person's impact for comparison
            const avgWeight = averageItemsPerYear * avgItemWeight;
            const avgWater = avgWeight * data.water;
            const avgCo2 = avgWeight * data.co2;
            const avgWaste = averageItemsPerYear * data.waste;
            
            // Show results first
            resultsDiv.style.display = "block";
            resultsDiv.scrollIntoView({ behavior: "smooth", block: "nearest" });
            
            // Reset to 0 first
            document.getElementById("water-result").textContent = "0";
            document.getElementById("co2-result").textContent = "0";
            document.getElementById("waste-result").textContent = "0";
            
            // Animate values counting up
            const animationDuration = 2000; // 2 seconds
            
            animateValue(
                document.getElementById("water-result"),
                0,
                waterLiters,
                animationDuration,
                formatNumber
            );
            
            animateValue(
                document.getElementById("co2-result"),
                0,
                co2Kg,
                animationDuration,
                formatNumber
            );
            
            animateValue(
                document.getElementById("waste-result"),
                0,
                wasteKg,
                animationDuration,
                formatNumber
            );
            
            // Add comparisons and average comparison
            setTimeout(() => {
                const bathtubs = Math.round(waterLiters / 150);
                document.getElementById("water-comparison").textContent = 
                    `‚âà ${bathtubs} bathtubs of water`;
                
                const carMiles = Math.round(co2Kg / 0.4); // ~0.4 kg CO2 per mile
                document.getElementById("co2-comparison").textContent = 
                    `‚âà ${carMiles} miles driven`;
                
                const trashBags = Math.round(wasteKg / 2); // ~2 kg per trash bag
                document.getElementById("waste-comparison").textContent = 
                    `‚âà ${trashBags} trash bags`;
                
                // Show comparison to average
                const comparisonBanner = document.getElementById('comparison-banner');
                const comparisonDetails = document.getElementById('comparison-details');
                
                // Check if dark mode is active
                const isDarkMode = document.documentElement.getAttribute('data-theme') === 'dark';
                
                const percentDiff = ((items - averageItemsPerYear) / averageItemsPerYear * 100).toFixed(0);
                const absPercent = Math.abs(percentDiff);
                
                if (items > averageItemsPerYear) {
                    comparisonDetails.textContent = `You buy ${absPercent}% more items than average. Reducing by ${Math.round(items - averageItemsPerYear)} items could save ${formatNumber((items - averageItemsPerYear) * avgItemWeight * data.water)}L of water.`;
                    if (isDarkMode) {
                        comparisonBanner.style.background = 'linear-gradient(135deg, #3d2a2a 0%, #4a2f2f 100%)';
                        comparisonBanner.style.borderColor = 'rgba(255, 87, 87, 0.3)';
                    } else {
                        comparisonBanner.style.background = 'linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%)';
                        comparisonBanner.style.borderColor = '';
                    }
                } else if (items < averageItemsPerYear) {
                    comparisonDetails.textContent = `You buy ${absPercent}% fewer items than average. Great job! You're saving ${formatNumber((averageItemsPerYear - items) * avgItemWeight * data.water)}L of water compared to average.`;
                    if (isDarkMode) {
                        comparisonBanner.style.background = 'linear-gradient(135deg, #2a3d2a 0%, #2f4a2f 100%)';
                        comparisonBanner.style.borderColor = 'rgba(74, 157, 122, 0.5)';
                    } else {
                        comparisonBanner.style.background = 'linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%)';
                        comparisonBanner.style.borderColor = '';
                    }
                } else {
                    comparisonDetails.textContent = `You're right at the average! Consider reducing by a few items to make an even bigger impact.`;
                    if (isDarkMode) {
                        comparisonBanner.style.background = 'linear-gradient(135deg, #3d3d2a 0%, #4a4a2f 100%)';
                        comparisonBanner.style.borderColor = 'rgba(255, 193, 7, 0.3)';
                    } else {
                        comparisonBanner.style.background = 'linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%)';
                        comparisonBanner.style.borderColor = '';
                    }
                }
                
                comparisonBanner.style.display = 'flex';
            }, animationDuration);
        }
        
        calculateBtn.addEventListener("click", calculateImpact);
        
        // Allow Enter key to calculate
        itemsInput.addEventListener("keypress", function(e) {
            if (e.key === "Enter") {
                calculateImpact();
            }
        });
    });
</script>

<script>
    // Interactive Material Chart
    document.addEventListener("DOMContentLoaded", function() {
        const chartBtns = document.querySelectorAll(".chart-btn");
        const chartBars = document.querySelectorAll(".chart-bar");
        
        // Chart data for different metrics
        const chartData = {
            water: {
                cotton: 10000,
                polyester: 2000,
                viscose: 6000,
                wool: 8000,
                labels: { cotton: "10,000L", polyester: "2,000L", viscose: "6,000L", wool: "8,000L" },
                tooltips: {
                    cotton: "<strong>Cotton</strong><br>Water: 10,000L/kg<br>CO‚ÇÇ: 15kg/kg<br>Most water-intensive",
                    polyester: "<strong>Polyester</strong><br>Water: 2,000L/kg<br>CO‚ÇÇ: 25kg/kg<br>Highest emissions",
                    viscose: "<strong>Viscose</strong><br>Water: 6,000L/kg<br>CO‚ÇÇ: 12kg/kg<br>Chemical-intensive",
                    wool: "<strong>Wool</strong><br>Water: 8,000L/kg<br>CO‚ÇÇ: 18kg/kg<br>High methane emissions"
                }
            },
            co2: {
                cotton: 15,
                polyester: 25,
                viscose: 12,
                wool: 18,
                labels: { cotton: "15kg", polyester: "25kg", viscose: "12kg", wool: "18kg" },
                tooltips: {
                    cotton: "<strong>Cotton</strong><br>Water: 10,000L/kg<br>CO‚ÇÇ: 15kg/kg<br>Most water-intensive",
                    polyester: "<strong>Polyester</strong><br>Water: 2,000L/kg<br>CO‚ÇÇ: 25kg/kg<br>Highest emissions",
                    viscose: "<strong>Viscose</strong><br>Water: 6,000L/kg<br>CO‚ÇÇ: 12kg/kg<br>Chemical-intensive",
                    wool: "<strong>Wool</strong><br>Water: 8,000L/kg<br>CO‚ÇÇ: 18kg/kg<br>High methane emissions"
                }
            },
            waste: {
                cotton: 0.5,
                polyester: 0.8,
                viscose: 0.6,
                wool: 0.4,
                labels: { cotton: "0.5kg", polyester: "0.8kg", viscose: "0.6kg", wool: "0.4kg" },
                tooltips: {
                    cotton: "<strong>Cotton</strong><br>Biodegradable<br>Waste: 0.5kg/item<br>Takes 1-5 months",
                    polyester: "<strong>Polyester</strong><br>Non-biodegradable<br>Waste: 0.8kg/item<br>Takes 200+ years",
                    viscose: "<strong>Viscose</strong><br>Partially biodegradable<br>Waste: 0.6kg/item<br>Chemical waste",
                    wool: "<strong>Wool</strong><br>Biodegradable<br>Waste: 0.4kg/item<br>Takes 1-5 years"
                }
            }
        };
        
        // Animate bars on load
        function animateBars(metric) {
            const data = chartData[metric];
            const maxValue = Math.max(...Object.values(data).filter(v => typeof v === 'number'));
            const chartContainer = document.querySelector('.chart-bars');
            const containerHeight = chartContainer ? chartContainer.offsetHeight - 100 : 300;
            
            chartBars.forEach((bar, index) => {
                const material = bar.closest('.chart-bar-wrapper').dataset.material;
                const value = data[material];
                const percentage = (value / maxValue) * 100;
                const height = (containerHeight * percentage) / 100;
                
                const fill = bar.querySelector('.bar-fill');
                const valueEl = bar.querySelector('.bar-value');
                const tooltip = bar.querySelector('.bar-tooltip');
                
                // Reset and animate height
                fill.style.height = '0px';
                setTimeout(() => {
                    fill.style.height = height + 'px';
                }, index * 100);
                
                // Update value
                valueEl.textContent = data.labels[material];
                
                // Update tooltip
                if (tooltip) {
                    tooltip.innerHTML = data.tooltips[material];
                }
            });
        }
        
        // Switch metrics
        chartBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                chartBtns.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                animateBars(this.dataset.metric);
            });
        });
        
        // Initial animation
        setTimeout(() => {
            animateBars('water');
        }, 500);
    });
    
    // Before/After Comparison Animation
    document.addEventListener("DOMContentLoaded", function() {
        const beforeBar = document.querySelector('.comparison-bar.before .bar-fill-animated');
        const afterBar = document.querySelector('.comparison-bar.after .bar-fill-animated');
        const statNumbers = document.querySelectorAll('.comparison-stat-card .stat-number');
        
        // Animate bars
        function animateComparison() {
            if (beforeBar) {
                beforeBar.style.width = '20%';
            }
            if (afterBar) {
                setTimeout(() => {
                    afterBar.style.width = '100%';
                }, 300);
            }
            
            // Animate stat numbers
            statNumbers.forEach(stat => {
                const target = parseInt(stat.dataset.target);
                let current = 0;
                const increment = target / 60;
                const duration = 2000;
                const stepTime = duration / 60;
                
                const timer = setInterval(() => {
                    current += increment;
                    if (current >= target) {
                        current = target;
                        clearInterval(timer);
                    }
                    stat.textContent = Math.round(current) + (target >= 100 ? '' : '%');
                }, stepTime);
            });
        }
        
        // Trigger animation when section is visible
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    animateComparison();
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.3 });
        
        const comparisonSection = document.querySelector('.comparison-visual');
        if (comparisonSection) {
            observer.observe(comparisonSection);
        }
    });
    </script>
    
{% endblock %}
